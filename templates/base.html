<!DOCTYPE html>
<html lang="{{ current_lang }}" class="scroll-smooth">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-921FP71YY9"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-921FP71YY9');
    </script>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- CANONICAL URL -->
    <link rel="canonical" href="{{ canonical_url }}">
    
    <!-- Multi-language SEO -->
    <link rel="alternate" hreflang="x-default" href="{{ generate_hreflang()['x-default'] }}" />
    <link rel="alternate" hreflang="en" href="{{ generate_hreflang()['en'] }}" />
    <link rel="alternate" hreflang="tr" href="{{ generate_hreflang()['tr'] }}" />
    
    <meta name="robots" content="index, follow">

    <!-- Dynamic Title & Description -->
    <title>{{ meta_title }}</title>
    <meta name="description" content="{{ meta_description }}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ meta_title }}">
    <meta property="og:description" content="{{ meta_description }}">
    <meta property="og:type" content="{{ og_type }}">
    <meta property="og:url" content="{{ canonical_url }}">
    <meta property="og:image" content="{{ og_image }}">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Bisonar",
        "url": "https://www.bisonar.com",
        "description": "Multilingual AI automation and workflow solutions",
        "availableLanguage": ["Turkish", "English"]
    }
    </script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
    <link rel="manifest" href="/static/images/site.webmanifest">
    
    <!-- CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { 
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat-bot.css') }}">
</head>
<body class="leading-relaxed overflow-x-hidden bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
    {% block content %}{% endblock %}
    
    <!-- CHATBOT WIDGET - SOL ALT KÖŞE -->
    <div class="chatbot-widget">
        <button class="chatbot-button" onclick="toggleChatbot()">🤖</button>
        <div class="chatbot-container" id="chatbotContainer">
            <div class="chatbot-header">
                <h3>AI Danışmanlık Asistanı / AI Consulting Assistant</h3>
                <button class="close-chatbot" onclick="toggleChatbot()">×</button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="chat-message bot-message">
                    👋 Merhaba! Bisonar AI Asistanına hoş geldiniz. Size nasıl yardımcı olabilirim?<br>
                    👋 Hello! Welcome to Bisonar AI Assistant. How can I help you?
                </div>
            </div>
            <div class="chatbot-quick-replies" id="chatbotQuickReplies">
                <button class="quick-reply-btn" onclick="sendQuickReply('n8n otomasyonu')">n8n Otomasyonu</button>
                <button class="quick-reply-btn" onclick="sendQuickReply('AI iş akışları')">AI İş Akışları</button>
                <button class="quick-reply-btn" onclick="sendQuickReply('danışmanlık hizmetleri')">Danışmanlık</button>
                <button class="quick-reply-btn" onclick="sendQuickReply('fiyat bilgisi')">Fiyat Bilgisi</button>
            </div>
            <div class="chatbot-input-container">
                <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Mesajınızı yazın / Type your message..." onkeypress="handleChatbotKeyPress(event)">
                <button class="send-button" onclick="sendChatbotMessage()">Gönder / Send</button>
            </div>
        </div>
    </div>

    <!-- Back to Top Button - SAĞ ALT KÖŞE -->
    <button id="backToTop" class="hidden fixed bottom-8 right-8 p-3 bg-purple-600 hover:bg-purple-700 text-white rounded-full shadow-lg transition-all duration-300 z-40 backdrop-blur-sm border border-purple-400/30">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat-bot.js') }}"></script>

        <script>
    // Ana sayfa için özel back to top fonksiyonu
    function handleBackToTop() {
        const backToTopBtn = document.getElementById('backToTop');
        
        if (!backToTopBtn) {
            console.log('❌ Back to Top button not found');
            return;
        }

        // Scroll event listener
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.remove('hidden');
            } else {
                backToTopBtn.classList.add('hidden');
            }
        });

        // Click event listener - ANA SAYFA İÇİN ÖZEL
        backToTopBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            console.log('🎯 Back to Top clicked');
            console.log('📍 Current path:', window.location.pathname);
            console.log('📍 Current hash:', window.location.hash);
            
            // ANA SAYFA MI KONTROL ET
            const isHomePage = window.location.pathname === '/' || 
                              window.location.pathname === '/en' || 
                              window.location.pathname === '/tr' ||
                              window.location.pathname === '';
            
            if (isHomePage) {
                console.log('🏠 Home page detected - special handling');
                
                // 1. Önce hash'i temizle
                if (window.location.hash) {
                    window.history.replaceState(null, null, window.location.pathname);
                }
                
                // 2. Scroll yapmadan önce küçük bir gecikme
                setTimeout(() => {
                    // 3. Tüm scroll methodlarını dene
                    const scrollOptions = { top: 0, behavior: 'smooth' };
                    
                    window.scrollTo(scrollOptions);
                    document.documentElement.scrollTo(scrollOptions);
                    document.body.scrollTo(scrollOptions);
                    
                    // 4. Fallback: instant scroll
                    setTimeout(() => {
                        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                        if (currentScroll > 50) {
                            console.log('🔄 Using fallback instant scroll');
                            window.scrollTo(0, 0);
                            document.documentElement.scrollTop = 0;
                            document.body.scrollTop = 0;
                        }
                    }, 200);
                    
                }, 50);
                
            } else {
                // BLOG SAYFASI - normal scroll
                console.log('📄 Blog page - normal scroll');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
        
        console.log('✅ Back to Top initialized for home page');
    }

    // DOM yüklendiğinde çalıştır
    document.addEventListener('DOMContentLoaded', handleBackToTop);
    
    // Eğer DOM zaten yüklendiyse
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', handleBackToTop);
    } else {
        handleBackToTop();
    }
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>